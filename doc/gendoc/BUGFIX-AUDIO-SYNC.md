# éŸ³ç”»åŒæ­¥é—®é¢˜ä¿®å¤è®°å½•

## ğŸ› é—®é¢˜æè¿°

åœ¨æ­¥éª¤äº”ï¼ˆæœ€ç»ˆåˆæˆï¼‰ä¸­å‘ç°çš„éŸ³ç”»ä¸åŒæ­¥é—®é¢˜ï¼š

### ç—‡çŠ¶
- æŸäº›åœºæ™¯æ²¡æœ‰å¯¹è¯ï¼ˆæ²¡æœ‰éŸ³é¢‘æ–‡ä»¶ï¼‰
- è¿™äº›åœºæ™¯åœ¨è§†é¢‘ä¸­åªæ˜¾ç¤ºå›¾ç‰‡ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤3ç§’ï¼‰
- ä½†éŸ³é¢‘ä¼šä¸€æ®µæ¥ä¸€æ®µæ’­æ”¾ï¼Œå¯¼è‡´éŸ³ç”»ä¸åŒæ­¥
- è¡¨ç°ä¸ºï¼šè§†é¢‘æ—¶é•¿ ~22ç§’ï¼Œä½†éŸ³é¢‘æ—¶é•¿ ~41ç§’

### æ ¹æœ¬åŸå› 

é—®é¢˜å‡ºåœ¨éŸ³é¢‘å‚æ•°ä¸ç»Ÿä¸€ï¼š

1. **æœ‰å¯¹è¯çš„åœºæ™¯**ï¼ˆä½¿ç”¨ TTS ç”Ÿæˆçš„éŸ³é¢‘ï¼‰
   - é‡‡æ ·ç‡ï¼š24000 Hz
   - å£°é“æ•°ï¼š1ï¼ˆå•å£°é“ï¼‰

2. **æ— å¯¹è¯çš„åœºæ™¯**ï¼ˆä½¿ç”¨ anullsrc ç”Ÿæˆçš„é™éŸ³ï¼‰
   - é‡‡æ ·ç‡ï¼š44100 Hz
   - å£°é“æ•°ï¼š2ï¼ˆç«‹ä½“å£°ï¼‰

å½“ä½¿ç”¨ `ffmpeg concat` åè®®æ‹¼æ¥è¿™äº›éŸ³é¢‘å‚æ•°ä¸ä¸€è‡´çš„è§†é¢‘ç‰‡æ®µæ—¶ï¼ŒFFmpeg ä¼šé”™è¯¯è®¡ç®—éŸ³é¢‘æ—¶é•¿ï¼Œå¯¼è‡´ä¸¥é‡çš„éŸ³ç”»ä¸åŒæ­¥ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒä¿®æ”¹

åœ¨ `generateVideoWithFFmpeg` å‡½æ•°ä¸­ï¼Œç»Ÿä¸€æ‰€æœ‰åœºæ™¯è§†é¢‘çš„éŸ³é¢‘å‚æ•°ï¼š

```go
// æœ‰éŸ³é¢‘çš„åœºæ™¯
args = []string{
    "-loop", "1",
    "-i", imagePath,
    "-i", audioPath,
    "-vf", fmt.Sprintf("subtitles=%s:...", ...),
    "-t", fmt.Sprintf("%.2f", duration),
    "-r", fmt.Sprintf("%d", fps),
    "-pix_fmt", "yuv420p",
    "-c:v", "libx264",
    "-c:a", "aac",
    "-ar", "44100",  // â† æ–°å¢ï¼šç»Ÿä¸€é‡‡æ ·ç‡ä¸º 44100 Hz
    "-ac", "2",      // â† æ–°å¢ï¼šç»Ÿä¸€ä¸ºç«‹ä½“å£°
    "-shortest",
    "-y",
    outputPath,
}

// æ— éŸ³é¢‘çš„åœºæ™¯ï¼ˆç”Ÿæˆé™éŸ³ï¼‰
args = []string{
    "-loop", "1",
    "-i", imagePath,
    "-f", "lavfi",
    "-i", "anullsrc=channel_layout=stereo:sample_rate=44100",
    "-vf", fmt.Sprintf("subtitles=%s:...", ...),
    "-t", fmt.Sprintf("%.2f", duration),
    "-r", fmt.Sprintf("%d", fps),
    "-pix_fmt", "yuv420p",
    "-c:v", "libx264",
    "-c:a", "aac",
    "-ar", "44100",  // â† ç»Ÿä¸€é‡‡æ ·ç‡
    "-ac", "2",      // â† ç»Ÿä¸€å£°é“æ•°
    "-shortest",
    "-y",
    outputPath,
}
```

### å…³é”®å‚æ•°è¯´æ˜

| å‚æ•° | ä½œç”¨ | å€¼ |
|------|------|-----|
| `-ar` | éŸ³é¢‘é‡‡æ ·ç‡ï¼ˆAudio Rateï¼‰ | `44100` Hz |
| `-ac` | éŸ³é¢‘å£°é“æ•°ï¼ˆAudio Channelsï¼‰ | `2`ï¼ˆç«‹ä½“å£°ï¼‰ |
| `-c:v` | è§†é¢‘ç¼–ç å™¨ | `libx264` |
| `-c:a` | éŸ³é¢‘ç¼–ç å™¨ | `aac` |

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰

```bash
$ ffprobe demo-final.mp4
codec_type=video
duration=22.420003
codec_type=audio
duration=41.239417  # âŒ éŸ³é¢‘æ—¶é•¿å¼‚å¸¸
```

å„åœºæ™¯éŸ³é¢‘å‚æ•°ä¸ä¸€è‡´ï¼š
```
segment_001: 24000 Hz, å•å£°é“
segment_002: 44100 Hz, ç«‹ä½“å£°
segment_003: 44100 Hz, ç«‹ä½“å£°
segment_004: 24000 Hz, å•å£°é“
segment_005: 44100 Hz, ç«‹ä½“å£°
```

### ä¿®å¤å

```bash
$ ffprobe demo-final.mp4
codec_type=video
duration=22.420003
codec_type=audio
duration=22.443220  # âœ… éŸ³ç”»åŒæ­¥
```

æ‰€æœ‰åœºæ™¯éŸ³é¢‘å‚æ•°ç»Ÿä¸€ï¼š
```
segment_001: 44100 Hz, ç«‹ä½“å£°
segment_002: 44100 Hz, ç«‹ä½“å£°
segment_003: 44100 Hz, ç«‹ä½“å£°
segment_004: 44100 Hz, ç«‹ä½“å£°
segment_005: 44100 Hz, ç«‹ä½“å£°
```

## ğŸ¯ æŠ€æœ¯è¦ç‚¹

### 1. FFmpeg Concat åè®®çš„è¦æ±‚

ä½¿ç”¨ `ffmpeg concat` åè®®æ‹¼æ¥è§†é¢‘æ—¶ï¼š
- æ‰€æœ‰ç‰‡æ®µçš„è§†é¢‘ç¼–ç å‚æ•°åº”ä¸€è‡´ï¼ˆåˆ†è¾¨ç‡ã€å¸§ç‡ã€ç¼–ç æ ¼å¼ï¼‰
- **æ‰€æœ‰ç‰‡æ®µçš„éŸ³é¢‘ç¼–ç å‚æ•°åº”ä¸€è‡´**ï¼ˆé‡‡æ ·ç‡ã€å£°é“æ•°ã€ç¼–ç æ ¼å¼ï¼‰
- å‚æ•°ä¸ä¸€è‡´ä¼šå¯¼è‡´æ—¶é•¿è®¡ç®—é”™è¯¯æˆ–æ‹¼æ¥å¤±è´¥

### 2. ä¸ºä»€ä¹ˆé€‰æ‹© 44100 Hz

- **æ ‡å‡†é‡‡æ ·ç‡**ï¼š44.1 kHz æ˜¯ CD éŸ³è´¨æ ‡å‡†
- **å…¼å®¹æ€§å¥½**ï¼šæ‰€æœ‰æ’­æ”¾å™¨éƒ½æ”¯æŒ
- **è´¨é‡è¶³å¤Ÿ**ï¼šå¯¹äºè¯­éŸ³æ¥è¯´å®Œå…¨å¤Ÿç”¨
- **æ¯” 48000 Hz æ›´å¸¸è§**ï¼šç½‘ç»œè§†é¢‘é€šå¸¸ä½¿ç”¨ 44.1 kHz

### 3. ä¸ºä»€ä¹ˆé€‰æ‹©ç«‹ä½“å£°

- **å…¼å®¹æ€§**ï¼šæ‰€æœ‰è®¾å¤‡éƒ½æ”¯æŒç«‹ä½“å£°
- **å¯é™çº§**ï¼šç«‹ä½“å£°å¯ä»¥è½»æ¾é™çº§ä¸ºå•å£°é“
- **TTS è½¬æ¢**ï¼šå•å£°é“ TTS éŸ³é¢‘ä¼šè¢«è½¬æ¢ä¸ºç«‹ä½“å£°ï¼ˆå·¦å³å£°é“ç›¸åŒï¼‰
- **æ–‡ä»¶å¤§å°**ï¼šå¯¹äºè¯­éŸ³ï¼Œç«‹ä½“å£°å’Œå•å£°é“çš„æ–‡ä»¶å¤§å°å·®å¼‚å¾ˆå°

## ğŸ” è°ƒè¯•æ–¹æ³•

å¦‚æœé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š

### 1. æ£€æŸ¥å•ä¸ªç‰‡æ®µ

```bash
ffprobe -v error -show_entries stream=sample_rate,channels,duration \
  -of default=noprint_wrappers=1 segment_001.mp4
```

### 2. æ‰¹é‡æ£€æŸ¥æ‰€æœ‰ç‰‡æ®µ

```bash
for f in temp_video_segments/segment_*.mp4; do
  echo "=== $(basename $f) ==="
  ffprobe -v error -select_streams a:0 \
    -show_entries stream=sample_rate,channels,duration \
    -of default=noprint_wrappers=1 "$f"
done
```

### 3. æ£€æŸ¥æœ€ç»ˆè§†é¢‘

```bash
# æŸ¥çœ‹æµä¿¡æ¯
ffprobe -v error -show_entries stream=codec_type,sample_rate,channels,duration \
  -of default=noprint_wrappers=1 final.mp4

# æŸ¥çœ‹æ ¼å¼æ—¶é•¿
ffprobe -v error -show_entries format=duration \
  -of default=noprint_wrappers=1:nokey=1 final.mp4
```

### 4. æ‰‹åŠ¨æµ‹è¯• Concat

```bash
# åˆ›å»ºæµ‹è¯•åˆ—è¡¨
cat > test.list << EOF
file '/path/to/segment_001.mp4'
file '/path/to/segment_002.mp4'
EOF

# æ‰§è¡Œæ‹¼æ¥å¹¶æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
ffmpeg -f concat -safe 0 -i test.list -c copy test-output.mp4
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. éŸ³é¢‘å‚æ•°æ ‡å‡†åŒ–

åœ¨ç”Ÿæˆä»»ä½•è§†é¢‘ç‰‡æ®µæ—¶ï¼Œéƒ½åº”è¯¥ï¼š
- ä½¿ç”¨ä¸€è‡´çš„é‡‡æ ·ç‡ï¼ˆæ¨è 44100 Hz æˆ– 48000 Hzï¼‰
- ä½¿ç”¨ä¸€è‡´çš„å£°é“æ•°ï¼ˆæ¨èç«‹ä½“å£°ï¼‰
- ä½¿ç”¨ä¸€è‡´çš„ç¼–ç æ ¼å¼ï¼ˆæ¨è AACï¼‰

### 2. ä¸ºæ— éŸ³é¢‘åœºæ™¯ç”Ÿæˆé™éŸ³è½¨é“

ä¸è¦ç”Ÿæˆå®Œå…¨æ²¡æœ‰éŸ³é¢‘è½¨é“çš„è§†é¢‘ï¼Œè€Œæ˜¯ç”Ÿæˆå¸¦é™éŸ³è½¨é“çš„è§†é¢‘ï¼š

```bash
# âœ… æ­£ç¡®ï¼šå¸¦é™éŸ³éŸ³é¢‘è½¨é“
ffmpeg -loop 1 -i image.png \
  -f lavfi -i "anullsrc=channel_layout=stereo:sample_rate=44100" \
  -t 3 -c:v libx264 -c:a aac -ar 44100 -ac 2 output.mp4

# âŒ é”™è¯¯ï¼šæ²¡æœ‰éŸ³é¢‘è½¨é“
ffmpeg -loop 1 -i image.png -t 3 -c:v libx264 output.mp4
```

### 3. ä½¿ç”¨ Concat Demuxer

å¯¹äºå¤šä¸ªè§†é¢‘ç‰‡æ®µæ‹¼æ¥ï¼Œä½¿ç”¨ concat demuxer è€Œä¸æ˜¯ filterï¼š

```bash
# âœ… æ­£ç¡®ï¼šä½¿ç”¨ concat demuxer + copy ç¼–ç ï¼ˆå¿«é€Ÿã€æ— æŸï¼‰
ffmpeg -f concat -safe 0 -i list.txt -c copy output.mp4

# âŒ ä¸æ¨èï¼šä½¿ç”¨ concat filterï¼ˆæ…¢ã€éœ€è¦é‡æ–°ç¼–ç ï¼‰
ffmpeg -i input1.mp4 -i input2.mp4 \
  -filter_complex "[0:v][0:a][1:v][1:a]concat=n=2:v=1:a=1" output.mp4
```

### 4. æµ‹è¯•éªŒè¯

ç”Ÿæˆè§†é¢‘åï¼Œå§‹ç»ˆéªŒè¯ï¼š
```bash
# æ£€æŸ¥éŸ³è§†é¢‘æ—¶é•¿æ˜¯å¦ä¸€è‡´
ffprobe -v error -show_entries stream=duration \
  -of default=noprint_wrappers=1 output.mp4
```

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [FINALASSEMBLY.md](FINALASSEMBLY.md) - æ­¥éª¤äº”ä½¿ç”¨æ–‡æ¡£
- [STEP5-SUMMARY.md](STEP5-SUMMARY.md) - æ­¥éª¤äº”æŠ€æœ¯æ€»ç»“
- [FFmpeg å®˜æ–¹æ–‡æ¡£ - Concat](https://ffmpeg.org/ffmpeg-formats.html#concat-1)
- [FFmpeg å®˜æ–¹æ–‡æ¡£ - Audio Options](https://ffmpeg.org/ffmpeg.html#Audio-Options)

## âœ… ç»“è®º

é€šè¿‡ç»Ÿä¸€æ‰€æœ‰è§†é¢‘ç‰‡æ®µçš„éŸ³é¢‘å‚æ•°ï¼ˆé‡‡æ ·ç‡ã€å£°é“æ•°ï¼‰ï¼ŒæˆåŠŸè§£å†³äº†éŸ³ç”»ä¸åŒæ­¥é—®é¢˜ã€‚è¿™ä¸ªä¿®å¤ç¡®ä¿äº†ï¼š

1. âœ… æ‰€æœ‰åœºæ™¯ï¼ˆæœ‰éŸ³é¢‘å’Œæ— éŸ³é¢‘ï¼‰éƒ½æœ‰éŸ³é¢‘è½¨é“
2. âœ… æ‰€æœ‰éŸ³é¢‘å‚æ•°å®Œå…¨ä¸€è‡´
3. âœ… FFmpeg concat èƒ½æ­£ç¡®è®¡ç®—å’Œæ‹¼æ¥éŸ³é¢‘
4. âœ… æœ€ç»ˆè§†é¢‘éŸ³ç”»å®Œç¾åŒæ­¥

---

**ä¿®å¤æ—¥æœŸ**: 2025-10-24  
**å½±å“ç‰ˆæœ¬**: v1.0  
**ä¿®å¤æäº¤**: ç»Ÿä¸€éŸ³é¢‘å‚æ•°ä¿®å¤éŸ³ç”»åŒæ­¥

